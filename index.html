<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VoxLab</title>

<style>
body{
  margin:0;
  font-family:Arial;
  color:white;
  text-align:center;
  background:linear-gradient(270deg,#0f0c29,#302b63,#24243e);
  background-size:600% 600%;
  animation:bg 10s infinite alternate;
}
@keyframes bg{
  0%{background-position:0%}
  100%{background-position:100%}
}

.box{
  background:rgba(255,255,255,.05);
  margin:15px;
  padding:20px;
  border-radius:20px;
  box-shadow:0 0 25px cyan;
}

button,input{
  padding:12px;
  margin:6px;
  border:none;
  border-radius:10px;
}

button{background:cyan;font-weight:bold}
.slider{width:85%}

#bars{
  display:flex;
  justify-content:center;
  gap:3px;
  height:40px;
  margin:10px;
}
.bar{
  width:6px;
  background:lime;
  height:5px;
  border-radius:3px;
}

.card{
  background:#111;
  padding:10px;
  margin:10px;
  border-radius:12px;
}
</style>
</head>

<body>

<h2>VoxLab</h2>

<div class="box">

<input id="name" placeholder="Voice name"><br>

<button onclick="startRec()">Record</button>
<button onclick="stopRec()">Stop</button>
<button onclick="save()">Save</button>

<div id="bars"></div>

Pitch<br>
<input id="pitch" type="range" min="0.5" max="2" step="0.1" value="1" class="slider">

<br>Speed<br>
<input id="speed" type="range" min="0.5" max="2" step="0.1" value="1" class="slider">

<br>

<button onclick="preset='normal'">Normal</button>
<button onclick="preset='thin'">Thin</button>
<button onclick="preset='bass'">Bass</button>
<button onclick="preset='scary'">Scary</button>

<br><br>

<input id="search" placeholder="Search" oninput="render()">

<h3>Saved Voices</h3>
<div id="list"></div>

</div>

<script>
let audioCtx=new (window.AudioContext||window.webkitAudioContext)();
let analyser=audioCtx.createAnalyser();
analyser.fftSize=64;

let barsDiv=document.getElementById("bars");
for(let i=0;i<20;i++){
  let d=document.createElement("div");
  d.className="bar";
  barsDiv.appendChild(d);
}

let mediaRecorder,chunks=[],preset="normal",anim;
let voices=JSON.parse(localStorage.getItem("voices")||"[]");

async function startRec(){
  await audioCtx.resume();
  let stream=await navigator.mediaDevices.getUserMedia({audio:true});

  let src=audioCtx.createMediaStreamSource(stream);
  src.connect(analyser);

  mediaRecorder=new MediaRecorder(stream);
  chunks=[];

  mediaRecorder.ondataavailable=e=>{
    if(e.data.size>0)chunks.push(e.data);
  };

  mediaRecorder.start();
  drawBars();
}

function stopRec(){
  if(mediaRecorder){
    mediaRecorder.stop();
    mediaRecorder.stream.getTracks().forEach(t=>t.stop());
    cancelAnimationFrame(anim);
    clearBars();
  }
}

function drawBars(){
  let data=new Uint8Array(analyser.frequencyBinCount);
  function draw(){
    analyser.getByteFrequencyData(data);
    let bars=document.querySelectorAll(".bar");
    bars.forEach((b,i)=>{
      let v=data[i]/255;
      b.style.height=(5+v*40)+"px";
    });
    anim=requestAnimationFrame(draw);
  }
  draw();
}

function clearBars(){
  document.querySelectorAll(".bar")
    .forEach(b=>b.style.height="5px");
}

function save(){
  if(!chunks.length)return;

  let blob=new Blob(chunks,{type:"audio/webm"});
  let r=new FileReader();

  r.onloadend=()=>{
    voices.push({
      name:document.getElementById("name").value||"Voice",
      data:r.result,
      preset:preset
    });
    localStorage.setItem("voices",JSON.stringify(voices));
    chunks=[];
    render();
  };
  r.readAsDataURL(blob);
}

async function play(v){
  await audioCtx.resume();

  let audio=new Audio(v.data);
  let src=audioCtx.createMediaElementSource(audio);

  let low=audioCtx.createBiquadFilter();
  low.type="lowshelf";
  low.frequency.value=200;

  let high=audioCtx.createBiquadFilter();
  high.type="highshelf";
  high.frequency.value=3000;

  let delay=audioCtx.createDelay();
  let fb=audioCtx.createGain();
  delay.delayTime.value=0.3;
  fb.gain.value=0.5;
  delay.connect(fb);
  fb.connect(delay);

  if(v.preset==="thin"){
    low.gain.value=-40;
    high.gain.value=25;
  }
  else if(v.preset==="bass"){
    low.gain.value=40;
    high.gain.value=-15;
  }
  else if(v.preset==="scary"){
    low.gain.value=-10;
    high.gain.value=30;
    src.connect(delay);
    delay.connect(audioCtx.destination);
  }

  src.connect(low);
  low.connect(high);
  high.connect(audioCtx.destination);

  audio.playbackRate=
    document.getElementById("pitch").value*
    document.getElementById("speed").value;

  audio.play();
}

// SHARE TO WHATSAPP
async function shareVoice(v){
  let res=await fetch(v.data);
  let blob=await res.blob();

  let file=new File([blob],"voice.webm",{type:"audio/webm"});

  if(navigator.share){
    navigator.share({
      files:[file],
      title:"Voice Note"
    });
  }else{
    alert("Sharing not supported on this device");
  }
}

function del(i){
  voices.splice(i,1);
  localStorage.setItem("voices",JSON.stringify(voices));
  render();
}

function render(){
  let q=document.getElementById("search").value.toLowerCase();
  let list=document.getElementById("list");
  list.innerHTML="";

  voices.forEach((v,i)=>{
    if(!v.name.toLowerCase().includes(q))return;

    list.innerHTML+=`
      <div class="card">
        ${v.name} (${v.preset})<br>
        <button onclick='play(${JSON.stringify(v)})'>Play</button>
        <button onclick='shareVoice(${JSON.stringify(v)})'>Share</button>
        <button onclick='del(${i})'>Delete</button>
      </div>`;
  });
}
render();
</script>

</body>
</html>